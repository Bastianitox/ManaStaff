<ion-content class="ion-padding" [fullscreen]="false">
  <!-- modal del PIN -->
  <div class="pin-overlay" *ngIf="showPinModal">
    <div class="pin-modal-container">
      <div class="pin-modal-content">
        <!-- Icono de candado -->
        <div class="pin-icon">
          <ion-icon name="lock-closed-outline"></ion-icon>
        </div>

        <h2 class="pin-title">Verificación de acceso</h2>
        <p class="pin-subtitle">Ingresa tu código PIN de 4 dígitos para ver tus documentos</p>

        <!-- Inputs de PIN -->
        <div class="pin-inputs">
          <input
            type="password"
            maxlength="1"
            class="pin-input"
            [(ngModel)]="pinInputs[0]"
            (input)="onPinInput(0, $event)"
            #pinField
            inputmode="numeric">

          <input
            type="password"
            maxlength="1"
            class="pin-input"
            [(ngModel)]="pinInputs[1]"
            (input)="onPinInput(1, $event)"
            #pinField
            inputmode="numeric">

          <input
            type="password"
            maxlength="1"
            class="pin-input"
            [(ngModel)]="pinInputs[2]"
            (input)="onPinInput(2, $event)"
            #pinField
            inputmode="numeric">

          <input
            type="password"
            maxlength="1"
            class="pin-input"
            [(ngModel)]="pinInputs[3]"
            (input)="onPinInput(3, $event)"
            #pinField
            inputmode="numeric">
        </div>

        <!-- Mensaje de error -->
        <p class="pin-error" *ngIf="pinError">{{ pinError }}</p>

        <!-- Botón de verificar -->
        <button
          class="pin-button"
          (click)="verifyPin()"
          [disabled]="isPinIncomplete()">
          Verificar código
        </button>
      </div>
    </div>
  </div>

  <!-- modal de filtros -->
  <ion-modal 
    [isOpen]="showFilterModal"
    class="filter-modal">
    <ng-template ionModalContent>
      <ion-header class="ion-no-border">
        <ion-toolbar class="filter-toolbar">
          <ion-title class="filter-modal-title">Filtrar documentos</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="closeFilterModal()" class="close-btn">
              <ion-icon name="close-outline"></ion-icon>
            </ion-button>
          </ion-buttons>
        </ion-toolbar>
        <div class="filter-description">
          <p>Refina tu búsqueda por tipo, estado o tamaño</p>
        </div>
      </ion-header>

      <ion-content class="filter-content">
        <!-- Tipo de documento -->
        <div class="filter-card">
          <div class="filter-card-header">
            <ion-icon name="document-text-outline" class="filter-icon"></ion-icon>
            <h3 class="filter-label">Tipo de documento</h3>
          </div>
          <div class="filter-options">
            <label class="filter-checkbox" *ngFor="let type of documentTypes">
              <input 
                type="checkbox" 
                [(ngModel)]="filters.types[type]"
                (change)="applyFilters()">
              <span class="checkbox-label">{{ type }}</span>
            </label>
          </div>
        </div>

        <!-- Tamaño -->
        <div class="filter-card">
          <div class="filter-card-header">
            <ion-icon name="resize-outline" class="filter-icon"></ion-icon>
            <h3 class="filter-label">Tamaño</h3>
          </div>
          <div class="filter-options">
            <label class="filter-checkbox" *ngFor="let size of sizeOptions">
              <input 
                type="checkbox" 
                [(ngModel)]="filters.sizes[size.key]"
                (change)="applyFilters()">
              <span class="checkbox-label">{{ size.label }}</span>
            </label>
          </div>
        </div>

        <!-- Estado -->
        <div class="filter-card">
          <div class="filter-card-header">
            <ion-icon name="time-outline" class="filter-icon"></ion-icon>
            <h3 class="filter-label">Estado</h3>
          </div>
          <div class="filter-options">
            <label class="filter-checkbox" *ngFor="let status of statusOptions">
              <input 
                type="checkbox" 
                [(ngModel)]="filters.statuses[status]"
                (change)="applyFilters()">
              <span class="checkbox-label">{{ status }}</span>
            </label>
          </div>
        </div>

        <!-- Ordenar por -->
        <div class="filter-card">
          <div class="filter-card-header">
            <ion-icon name="swap-vertical-outline" class="filter-icon"></ion-icon>
            <h3 class="filter-label">Ordenar por</h3>
          </div>
          <div class="filter-options">
            <label class="filter-radio">
              <input 
                type="radio" 
                name="sortBy" 
                value="date"
                [(ngModel)]="filters.sortBy"
                (change)="applyFilters()">
              <span class="radio-label">Fecha</span>
            </label>
            <label class="filter-radio">
              <input 
                type="radio" 
                name="sortBy" 
                value="name"
                [(ngModel)]="filters.sortBy"
                (change)="applyFilters()">
              <span class="radio-label">Nombre</span>
            </label>
          </div>
          <div class="filter-options" style="margin-top: 8px;">
            <label class="filter-radio">
              <input 
                type="radio" 
                name="sortOrder" 
                value="asc"
                [(ngModel)]="filters.sortOrder"
                (change)="applyFilters()">
              <span class="radio-label">Ascendente</span>
            </label>
            <label class="filter-radio">
              <input 
                type="radio" 
                name="sortOrder" 
                value="desc"
                [(ngModel)]="filters.sortOrder"
                (change)="applyFilters()">
              <span class="radio-label">Descendente</span>
            </label>
          </div>
        </div>
      </ion-content>

      <!-- Footer -->
      <div class="filter-footer">
        <button class="btn-secondary" (click)="clearFilters()">
          Limpiar
        </button>
        <button class="btn-primary" (click)="closeFilterModal()">
          Aplicar filtros
        </button>
      </div>
    </ng-template>
  </ion-modal>

  <!-- Buscador y botón de filtro -->
  <div class="search-filter-container">
    <ion-searchbar 
      class="search-bar"
      placeholder="Busca tus archivos…"
      [(ngModel)]="searchQuery"
      (ionInput)="onSearch($event)"
      debounce="300">
    </ion-searchbar>
    <button class="filter-button" (click)="openFilterModal()">
      <ion-icon name="funnel-outline"></ion-icon>
    </button>
  </div>

  <!-- Grid de documentos -->
  <div class="documents-container" *ngIf="filteredDocuments.length > 0">
    <div class="documents-grid">
      <div class="document-card" *ngFor="let doc of filteredDocuments">
        <!-- Badge de estado -->
        <div class="badge" [ngClass]="'badge-' + doc.tipo_estado_nombre">
          {{ doc.tipo_estado_nombre }}
        </div>

        <!-- Icono del archivo -->
        <div class="card-icon">
          <ion-icon [name]="getFileIcon(doc.tipo_documento)"></ion-icon>
        </div>

        <!-- Contenido -->
        <div class="card-content">
          <h3 class="card-title">{{ doc.nombre }}</h3>
          <div class="card-meta">
            <span class="meta-item">{{ doc.tipo_documento }}</span>
            <span class="meta-separator">•</span>
            <span class="meta-item">{{ doc.tamano_archivo }}</span>
            <span class="meta-separator">•</span>
            <span class="meta-item">{{ doc.Fecha_emitida }}</span>
          </div>
        </div>

        <!-- Acciones -->
        <div class="card-actions">
          <button 
            class="action-btn view-btn"
            [disabled]="doc.tipo_estado_nombre === 'Pendiente'"
            (click)="viewDocument(doc)">
            Ver
          </button>
          <button 
            class="action-btn download-btn"
            [disabled]="doc.tipo_estado_nombre === 'Pendiente'"
            (click)="downloadDocument(doc)">
            Descargar
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Estado vacío -->
  <div class="empty-state" *ngIf="filteredDocuments.length === 0 && !isLoading">
    <div class="empty-icon">
      <ion-icon name="folder-open-outline"></ion-icon>
    </div>
    <h3 class="empty-title">No se encontraron documentos</h3>
    <p class="empty-subtitle">Intenta cambiar el filtro o buscar otra palabra</p>
  </div>

  <!-- Estado de carga -->
  <div class="loading-state" *ngIf="isLoading">
    <ion-spinner></ion-spinner>
    <p>Cargando documentos...</p>
  </div>
</ion-content>
