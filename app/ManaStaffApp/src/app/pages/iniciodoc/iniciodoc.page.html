<ion-header class="ion-no-border">
  <ion-toolbar class="header-toolbar">
    <div class="header-container">
      <!-- Logo -->
      <div class="header-left">
        <div class="company-logo">
          <img src="assets/img/logo_grande.png" alt="Logo empresa" class="company-logo-img" />
        </div>
      </div>
      
      <!-- Título -->
      <div class="header-right">
        <h1 class="header-title">Mis documentos</h1>
      </div>
    </div>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding" [fullscreen]="false">
  <!-- modal del PIN -->
  <ion-modal 
    [isOpen]="showPinModal" 
    [backdropDismiss]="false"
    class="pin-modal">
    <ng-template ionModalContent>
      <div class="pin-modal-container">
        <div class="pin-modal-content">
          <!-- Icono de candado -->
          <div class="pin-icon">
            <ion-icon name="lock-closed-outline"></ion-icon>
          </div>

          <h2 class="pin-title">Verificación de acceso</h2>
          <p class="pin-subtitle">Ingresa tu código PIN de 4 dígitos para ver tus documentos</p>

          <!-- Inputs de PIN -->
          <div class="pin-inputs">
            <input 
              type="password" 
              maxlength="1" 
              class="pin-input"
              [(ngModel)]="pinInputs[0]"
              (input)="onPinInput(0, $event)"
              #pinField
              inputmode="numeric">

            <input 
              type="password" 
              maxlength="1" 
              class="pin-input"
              [(ngModel)]="pinInputs[1]"
              (input)="onPinInput(1, $event)"
              #pinField
              inputmode="numeric">

            <input 
              type="password" 
              maxlength="1" 
              class="pin-input"
              [(ngModel)]="pinInputs[2]"
              (input)="onPinInput(2, $event)"
              #pinField
              inputmode="numeric">

            <input 
              type="password" 
              maxlength="1" 
              class="pin-input"
              [(ngModel)]="pinInputs[3]"
              (input)="onPinInput(3, $event)"
              #pinField
              inputmode="numeric">
          </div>

          <!-- Mensaje de error -->
          <p class="pin-error" *ngIf="pinError">{{ pinError }}</p>

          <!-- Botón de verificar -->
          <button 
            class="pin-button"
            (click)="verifyPin()"
            [disabled]="isPinIncomplete()">
            Verificar código
          </button>
        </div>
      </div>
    </ng-template>
  </ion-modal>

  <!-- modal de filtros -->
  <ion-modal 
    [isOpen]="showFilterModal"
    class="filter-modal">
    <ng-template ionModalContent>
      <ion-header class="ion-no-border">
        <ion-toolbar class="filter-toolbar">
          <ion-title class="filter-modal-title">Filtrar documentos</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="closeFilterModal()" class="close-btn">
              <ion-icon name="close-outline"></ion-icon>
            </ion-button>
          </ion-buttons>
        </ion-toolbar>
        <div class="filter-description">
          <p>Refina tu búsqueda por tipo, estado o tamaño</p>
        </div>
      </ion-header>

      <ion-content class="filter-content">
        <!-- Tipo de documento -->
        <div class="filter-card">
          <div class="filter-card-header">
            <ion-icon name="document-text-outline" class="filter-icon"></ion-icon>
            <h3 class="filter-label">Tipo de documento</h3>
          </div>
          <div class="filter-options">
            <label class="filter-checkbox" *ngFor="let type of documentTypes">
              <input 
                type="checkbox" 
                [(ngModel)]="filters.types[type]"
                (change)="applyFilters()">
              <span class="checkbox-label">{{ type }}</span>
            </label>
          </div>
        </div>

        <!-- Tamaño -->
        <div class="filter-card">
          <div class="filter-card-header">
            <ion-icon name="resize-outline" class="filter-icon"></ion-icon>
            <h3 class="filter-label">Tamaño</h3>
          </div>
          <div class="filter-options">
            <label class="filter-checkbox" *ngFor="let size of sizeOptions">
              <input 
                type="checkbox" 
                [(ngModel)]="filters.sizes[size.key]"
                (change)="applyFilters()">
              <span class="checkbox-label">{{ size.label }}</span>
            </label>
          </div>
        </div>

        <!-- Estado -->
        <div class="filter-card">
          <div class="filter-card-header">
            <ion-icon name="time-outline" class="filter-icon"></ion-icon>
            <h3 class="filter-label">Estado</h3>
          </div>
          <div class="filter-options">
            <label class="filter-checkbox" *ngFor="let status of statusOptions">
              <input 
                type="checkbox" 
                [(ngModel)]="filters.statuses[status]"
                (change)="applyFilters()">
              <span class="checkbox-label">{{ status }}</span>
            </label>
          </div>
        </div>

        <!-- Ordenar por -->
        <div class="filter-card">
          <div class="filter-card-header">
            <ion-icon name="swap-vertical-outline" class="filter-icon"></ion-icon>
            <h3 class="filter-label">Ordenar por</h3>
          </div>
          <div class="filter-options">
            <label class="filter-radio">
              <input 
                type="radio" 
                name="sortBy" 
                value="date"
                [(ngModel)]="filters.sortBy"
                (change)="applyFilters()">
              <span class="radio-label">Fecha</span>
            </label>
            <label class="filter-radio">
              <input 
                type="radio" 
                name="sortBy" 
                value="name"
                [(ngModel)]="filters.sortBy"
                (change)="applyFilters()">
              <span class="radio-label">Nombre</span>
            </label>
          </div>
          <div class="filter-options" style="margin-top: 8px;">
            <label class="filter-radio">
              <input 
                type="radio" 
                name="sortOrder" 
                value="asc"
                [(ngModel)]="filters.sortOrder"
                (change)="applyFilters()">
              <span class="radio-label">Ascendente</span>
            </label>
            <label class="filter-radio">
              <input 
                type="radio" 
                name="sortOrder" 
                value="desc"
                [(ngModel)]="filters.sortOrder"
                (change)="applyFilters()">
              <span class="radio-label">Descendente</span>
            </label>
          </div>
        </div>
      </ion-content>

      <!-- Footer sticky con fondo blanco y sombra superior -->
      <div class="filter-footer">
        <button class="btn-secondary" (click)="clearFilters()">
          Limpiar
        </button>
        <button class="btn-primary" (click)="closeFilterModal()">
          Aplicar filtros
        </button>
      </div>
    </ng-template>
  </ion-modal>

  <!-- Buscador y botón de filtro -->
  <div class="search-filter-container">
    <ion-searchbar 
      class="search-bar"
      placeholder="Busca tus archivos…"
      [(ngModel)]="searchQuery"
      (ionInput)="onSearch($event)"
      debounce="300">
    </ion-searchbar>
    <button class="filter-button" (click)="openFilterModal()">
      <ion-icon name="funnel-outline"></ion-icon>
    </button>
  </div>

  <!-- Grid de documentos -->
  <div class="documents-container" *ngIf="filteredDocuments.length > 0">
    <div class="documents-grid">
      <div class="document-card" *ngFor="let doc of filteredDocuments">
        <!-- Badge de estado -->
        <div class="badge" [ngClass]="'badge-' + doc.status">
          {{ doc.status }}
        </div>

        <!-- Icono del archivo -->
        <div class="card-icon">
          <ion-icon [name]="getFileIcon(doc.type)"></ion-icon>
        </div>

        <!-- Contenido -->
        <div class="card-content">
          <h3 class="card-title">{{ doc.name }}</h3>
          <div class="card-meta">
            <span class="meta-item">{{ doc.type }}</span>
            <span class="meta-separator">•</span>
            <span class="meta-item">{{ doc.size }}</span>
            <span class="meta-separator">•</span>
            <span class="meta-item">{{ doc.date }}</span>
          </div>
        </div>

        <!-- Acciones -->
        <div class="card-actions">
          <button 
            class="action-btn view-btn"
            [disabled]="doc.status === 'Pendiente'"
            (click)="viewDocument(doc)">
            Ver
          </button>
          <button 
            class="action-btn download-btn"
            [disabled]="doc.status === 'Pendiente'"
            (click)="downloadDocument(doc)">
            Descargar
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Estado vacío -->
  <div class="empty-state" *ngIf="filteredDocuments.length === 0 && !isLoading">
    <div class="empty-icon">
      <ion-icon name="folder-open-outline"></ion-icon>
    </div>
    <h3 class="empty-title">No se encontraron documentos</h3>
    <p class="empty-subtitle">Intenta cambiar el filtro o buscar otra palabra</p>
  </div>

  <!-- Estado de carga -->
  <div class="loading-state" *ngIf="isLoading">
    <ion-spinner></ion-spinner>
    <p>Cargando documentos...</p>
  </div>
</ion-content>

<!-- barra de navegación inferior -->
<div class="bottom-nav">
  <div class="bottom-nav-item bottom-nav-active" (click)="goToDocumentos()">
    <ion-icon name="document-text-outline"></ion-icon>
    <span>Mis documentos</span>
  </div>
  
  <div class="bottom-nav-item" (click)="goToSolicitudes()">
    <ion-icon name="chatbox-ellipses-outline"></ion-icon>
    <span>Solicitudes</span>
  </div>
  
  <div class="bottom-nav-item" (click)="goToNoticias()">
    <ion-icon name="megaphone-outline"></ion-icon>
    <span>Noticias y avisos</span>
  </div>

  <div class="bottom-nav-item" (click)="goToConfig()">
    <ion-icon name="settings-outline"></ion-icon>
    <span>Configuración</span>
  </div>
</div>




