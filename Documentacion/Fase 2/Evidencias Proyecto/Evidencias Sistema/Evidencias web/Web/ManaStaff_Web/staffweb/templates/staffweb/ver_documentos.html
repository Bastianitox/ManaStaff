{% extends 'staffweb/plantilla.html' %}
{% load static %}

{% block head %}
<link rel="stylesheet" href="{% static 'staffweb/css/ver_documentos.css' %}">
<title>Ver Documento</title>
{% endblock head %}

{% block principal %}
<div class="document-viewer-container">
    <div class="document-header">
        <button class="back-btn" onclick="window.history.back()">
            <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                <path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z"/>
            </svg>
            Volver
        </button>

        <div class="document-info">
            <h1 id="documentTitle">{{ documento.title|default:"Documento no encontrado" }}</h1>
            <div class="document-meta" id="documentMeta">
                {% if documento %}
                    <span class="meta-item"><strong>Formato:</strong> {{ documento.format }}</span>
                    <span class="meta-item"><strong>Tamaño:</strong> {{ documento.size }}</span>
                    <span class="meta-item"><strong>Fecha:</strong> {{ documento.date }}</span>
                {% else %}
                    <span class="meta-item error"><strong>Estado:</strong> No disponible</span>
                {% endif %}
            </div>
        </div>

        <div class="document-actions">
            {% if documento %}
                {% if documento.downloadPath %}
                    <a class="action-btn download-btn" href="{% url 'descargar_documento' documento.id %}">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M5,20H19V18H5M19,9H15V3H9V9H5L12,16L19,9Z"/>
                        </svg>
                        Descargar
                    </a>
                {% else %}
                    <button class="action-btn download-btn" disabled style="opacity:.5;cursor:not-allowed;">
                        Descargar
                    </button>
                {% endif %}

                <button class="action-btn delete-main-btn" id="btnDeleteDoc" data-doc-id="{{ documento.id }}">
                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z"/>
                    </svg>
                    Eliminar
                </button>
            {% endif %}
        </div>
    </div>
    
    <div class="document-content" id="documentContent">
        {% if documento and documento.filePath %}
            <div class="pdf-viewer">
                <iframe src="{{ documento.filePath }}" width="100%" height="600px" frameborder="0">
                    <p>Tu navegador no soporta la visualización integrada.
                        <a href="{{ documento.downloadPath|default:documento.filePath }}">Descargar</a>.
                    </p>
                </iframe>
            </div>
        {% else %}
            <div class="document-not-found">
                <div class="not-found-icon">
                    <svg width="64" height="64" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,17A1.5,1.5 0 0,1 10.5,15.5A1.5,1.5 0 0,1 12,14A1.5,1.5 0 0,1 13.5,15.5A1.5,1.5 0 0,1 12,17M12,10.5A1.5,1.5 0 0,1 10.5,9A1.5,1.5 0 0,1 12,7.5A1.5,1.5 0 0,1 13.5,9A1.5,1.5 0 0,1 12,10.5Z"/>
                    </svg>
                </div>
                <h3>Documento no encontrado</h3>
                <p>El documento solicitado no está disponible o no se pudo encontrar.</p>
                <button class="back-to-documents" onclick="window.location.href='/administrar_documentos'">
                    Volver a Administración
                </button>
            </div>
        {% endif %}
    </div>
</div>

<div id="deleteModal" class="modal hidden">
  <div class="modal-content" style="max-width:400px">
    <h3 class="delete-title">Eliminar documento</h3>
    <p>¿Eliminar este documento definitivamente?</p>
    <div class="modal-actions modal-actions-center">
      <button id="deleteCancelBtn" class="cancel-modal-btn">Cancelar</button>
      <button id="deleteConfirmBtn" class="confirm-delete-btn">Eliminar</button>
    </div>
  </div>
  <div id="loadingSpinner" class="hidden">
    <div class="spinner"></div>
  </div>
</div>

<div id="successAlert" class="alert success" style="display:none;">
  <div class="alert-icon">✓</div>
  <span id="successMessageAlert">Documento borrado con éxito. Redirigiendo...</span>
</div>

<div id="errorAlert" class="alert error" style="display:none;">
  <div class="alert-icon">✕</div>
  <span id="errorMessageAlert">No se pudo eliminar el documento.</span>
</div>

{% csrf_token %}

{% endblock principal %}

{% block js %}
  <script src="{% static 'staffweb/js/ver_documentos.js' %}"></script>
{% endblock js %}