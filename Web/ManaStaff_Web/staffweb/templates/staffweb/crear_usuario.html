{% extends 'staffweb/plantilla.html' %}
{% load static %}

{% block head %}
<link rel="stylesheet" href="{% static 'staffweb/css/crear_usuario.css' %}">
<script src="{% static 'staffweb/js/crear_usuario.js' %}"></script>
<title>Crear Usuario</title>
{% endblock head %}

{% block principal %}
<div class="header">
    <h1>Administrar usuarios</h1>
    <p>Aquí puedes crear un usuario</p>
</div>

<div class="container compact">
    <div class="form-wrapper">
        <div class="form-container">
            <form id="createUserForm" class="user-form" enctype="multipart/form-data" method="post">
                {% csrf_token %}

                <div class="form-section">
                    <h3 class="section-title">Información Personal</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="nombre">Nombre *</label>
                            <input type="text" id="nombre" name="nombre" maxlength="25" required>
                            <span class="error-message" id="nombre-error"></span>
                        </div>
                        <div class="form-group">
                            <label for="Segundo_nombre">Segundo nombre *</label>
                            <input type="text" id="Segundo_nombre" name="Segundo_nombre" maxlength="25" required>
                            <span class="error-message" id="Segundo_nombre-error"></span>
                        </div>
                        <div class="form-group">
                            <label for="rut">RUT *</label>
                            <input type="text" id="rut" name="rut" placeholder="12.345.678-9" maxlength="12" required>
                            <span class="error-message" id="rut-error"></span>
                        </div>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label for="apellido_paterno">Apellido Paterno *</label>
                            <input type="text" id="apellido_paterno" name="apellido_paterno" maxlength="50" required>
                            <span class="error-message" id="apellido_paterno-error"></span>
                        </div>
                        <div class="form-group">
                            <label for="apellido_materno">Apellido Materno *</label>
                            <input type="text" id="apellido_materno" name="apellido_materno" maxlength="50" required>
                            <span class="error-message" id="apellido_materno-error"></span>
                        </div>
                        <div class="form-group">
                            <label for="celular">Celular *</label>
                            <input type="tel" id="celular" name="celular" placeholder="+56 9 1234 5678" required>
                            <span class="error-message" id="celular-error"></span>
                        </div>
                    </div>

                    <div class="form-group full-width">
                        <label for="direccion">Dirección *</label>
                        <input type="text" id="direccion" name="direccion" maxlength="150" required>
                        <span class="error-message" id="direccion-error"></span>
                    </div>
                </div>

                <div class="form-section">
                    <h3 class="section-title">Información de Contacto y Rol</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="email">Correo Electrónico *</label>
                            <input type="email" id="email" name="email" maxlength="100" required>
                            <span class="error-message" id="email-error"></span>
                        </div>
                        <div class="form-group">
                            <label for="cargo">Cargo *</label>
                            <select id="cargo" name="cargo" required>
                                <option value="">Seleccionar cargo</option>
                            {% for cargo in cargos %}
                                <option value="{{cargo.id_cargo}}">{{cargo.nombre}}</option>
                            {% endfor %}
                            </select>
                            <span class="error-message" id="cargo-error"></span>
                        </div>
                        <div class="form-group">
                            <label for="rol">Rol *</label>
                            <select id="rol" name="rol" required>
                                <option value="">Seleccionar rol</option>
                                {% for rol in roles %}
                                    <option value="{{rol.id_rol}}">{{rol.nombre}}</option>
                                {% endfor %}
                            </select>
                            <span class="error-message" id="rol-error"></span>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3 class="section-title">Seguridad</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="pin">PIN de acceso *</label>
                            <input type="password" id="pin" name="pin" maxlength="4" placeholder="4 dígitos" required>
                            <span class="error-message" id="pin-error"></span>
                        </div>
                    </div>

                    <div class="form-group password-group">
                        <label for="password">Contraseña *</label>
                        <input type="password" id="password" name="password" required>
                        <span class="error-message" id="password-error"></span>
                        
                        <!-- Validador visual de requisitos -->
                        <div class="password-requirements">
                            <p class="requirements-title">La contraseña debe contener:</p>
                            <div class="requirements-list">
                                <div class="requirement-item" id="req-length">
                                    <span class="requirement-icon">✓</span>
                                    <span class="requirement-text">Entre 8 y 30 caracteres</span>
                                </div>
                                <div class="requirement-item" id="req-uppercase">
                                    <span class="requirement-icon">✓</span>
                                    <span class="requirement-text">Al menos una letra mayúscula</span>
                                </div>
                                <div class="requirement-item" id="req-lowercase">
                                    <span class="requirement-icon">✓</span>
                                    <span class="requirement-text">Al menos una letra minúscula</span>
                                </div>
                                <div class="requirement-item" id="req-number">
                                    <span class="requirement-icon">✓</span>
                                    <span class="requirement-text">Al menos un número</span>
                                </div>
                                <div class="requirement-item" id="req-special">
                                    <span class="requirement-icon">✓</span>
                                    <span class="requirement-text">Al menos un carácter especial</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button" id="cancelBtn" class="cancel-btn">Cancelar</button>
                    <button type="submit" id="submitBtn" class="submit-btn">Crear Usuario</button>
                </div>
            </form>
        </div>

        <div class="image-sidebar">
            <div class="image-preview-section">
                <div class="image-preview-container">
                    <img id="imagePreview" src="/placeholder.svg" alt="Vista previa" class="image-preview">
                    <svg class="image-placeholder" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M21 19V5a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2z"></path>
                        <circle cx="8.5" cy="8.5" r="1.5"></circle>
                        <polyline points="21 15 16 10 5 21"></polyline>
                    </svg>
                </div>
                <div class="image-upload-info">
                    <label for="imagen" class="image-label">Foto de perfil</label>
                    <input type="file" id="imagen" name="imagen" accept="image/*" class="image-input">
                    <p class="image-hint">JPG, PNG o GIF (máx 2MB)</p>
                    <span class="error-message" id="imagen-error"></span>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Mensaje de éxito -->
<div id="successMessage" class="success-message">
    Usuario creado con éxito
</div>
<!-- Overlay de carga -->
<div id="loadingOverlay">
    <div class="spinner"></div>
</div>

<script>
  window.REDIRECT_URL = "{% url 'administrar_usuarios' %}";
</script>
{% endblock principal %}
