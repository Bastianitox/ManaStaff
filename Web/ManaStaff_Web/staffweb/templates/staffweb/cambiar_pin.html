{% extends 'staffweb/plantilla.html' %}
{% load static %}

{% block head %}
<link rel="stylesheet" href="{% static 'staffweb/css/perfil.css' %}">
<link rel="stylesheet" href="{% static 'staffweb/css/cambiar_contrasena.css' %}">
<script src="{% static 'staffweb/js/cambiar_pin.js' %}"></script>
<script src="{% static 'staffweb/js/ojos_contra.js' %}"></script>
<title>Cambiar Pin</title>
{% endblock head%}

{% block principal %}

<div class="header">
    <h1>Cambiar Pin</h1>
    <p>Aquí puedes editar el pin de usuario</p>
</div>

<div class="perfil-formulario">
    <form method="post" id="form-cambiar-contrasena">
      {% csrf_token %}
      
      <div class="campo">
        <label for="pin_actual">Pin Actual</label>
        <div class="input-grupo">
          <input 
            type="password" 
            id="pin_actual" 
            name="pin_actual" 
            placeholder="Ingresa tu pin actual" 
            required
            inputmode="numeric"
            pattern="\d{4}"
            maxlength="4"
          >
          <button type="button" class="toggle-password" data-target="pin_actual" aria-label="Mostrar pin">
            <span class="icono-ojo">👁</span>
            <span class="icono-ojo-cerrado oculto">👁‍🗨</span>
          </button>
        </div>
      </div>

      <div class="campo">
        <label for="pin_nueva">Nuevo Pin</label>
        <div class="input-grupo">
          <input 
            type="password" 
            id="pin_nueva" 
            name="pin_nueva" 
            placeholder="Ingresa un nuevo pin (4 dígitos)" 
            required
            inputmode="numeric"
            pattern="\d{4}"
            maxlength="4"
          >
          <button type="button" class="toggle-password" data-target="pin_nueva" aria-label="Mostrar pin">
            <span class="icono-ojo">👁</span>
            <span class="icono-ojo-cerrado oculto">👁‍🗨</span>
          </button>
        </div>
      </div>

      <div class="campo">
        <label for="pin_confirmar">Confirmar Nuevo Pin</label>
        <div class="input-grupo">
          <input 
            type="password" 
            id="pin_confirmar" 
            name="pin_confirmar" 
            placeholder="Repite el nuevo pin" 
            required
            inputmode="numeric"
            pattern="\d{4}"
            maxlength="4"
          >
          <button type="button" class="toggle-password" data-target="pin_confirmar" aria-label="Mostrar pin">
            <span class="icono-ojo">👁</span>
            <span class="icono-ojo-cerrado oculto">👁‍🗨</span>
          </button>
        </div>
      </div>

      <div class="acciones-seguridad">
        <button id="submitBtn" type="submit" class="btn-guardar">Guardar Cambios</button>
        <a href="{% url 'inicio_perfil' %}" class="btn-cancelar">Cancelar</a>
      </div>
    </form>
</div>

<!-- ALERTAS CENTRADAS -->
<div id="successAlert" class="alert success" style="display:none;">
  <div class="alert-icon">✓</div>
  <span id="successMessageAlert">PIN modificado exitosamente.</span>
</div>

<div id="errorAlert" class="alert error" style="display:none;">
  <div class="alert-icon">✕</div>
  <span id="errorMessageAlert">Ocurrió un error al modificar el PIN.</span>
</div>

<!-- Overlay de carga -->
<div id="loadingOverlay">
    <div class="spinner"></div>
</div>

{% endblock principal %}

{% block js %}
<script>
    const currentUserRut = "{{ usuario_id|escapejs }}";
</script>
<script src="{% static 'staffweb/js/cambiar_pin.js' %}"></script>
{% endblock js %}