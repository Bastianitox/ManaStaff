{% extends 'staffweb/plantilla.html' %}
{% load static %}

{% block head %}
<link rel="stylesheet" href="{% static 'staffweb/css/administrar_usuarios.css' %}">
<title>Administración</title>
{% endblock head %}

{% block principal %}
<div class="header">
    <h1>Administrar usuarios</h1>
    <p>Aquí puedes modificar, crear, deshabilitar y habilitar usuarios o visualizar</p>
</div>

<div class="container">
    <!-- Buscador y Crear Usuario -->
    <div class="search-actions-section">
        <div class="search-container">
            <svg class="search-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                      d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
            </svg>
            <input type="text" id="searchInput" placeholder="Buscar usuario por nombre..." class="search-input">
        </div>

        <button id="createUserBtn" class="create-user-btn" data-url="{% url 'crear_usuario' %}">
            <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                <path d="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z"/>
            </svg>
            Crear Usuario
        </button>
    </div>

    <!-- Tabla de usuarios -->
    <div class="table-container">
        <table id="usersTable" class="users-table">
            <thead>
                <tr>
                    <th>RUT</th>
                    <th>Nombre Completo</th>
                    <th>Correo Electrónico</th>
                    <th>Cargo</th>
                    <th>Verificado</th>
                    <th>Fecha de Creación</th>
                    <th>Último acceso</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody id="usersTableBody" data-edit-url="{% url 'modificar_usuario' %}">
            </tbody>
        </table>
    </div>

    <!-- Paginación -->
    <div class="pager">
        <button data-pg="prev" class="pagination-btn" disabled>
            <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                <path d="M15.41,16.58L10.83,12L15.41,7.41L14,6L8,12L14,18L15.41,16.58Z"/>
            </svg>
        </button>

        <span data-pg="info" class="page-info">Página 1 de 1</span>

        <button data-pg="next" class="pagination-btn" disabled>
            <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                <path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z"/>
            </svg>
        </button>
    </div>
</div>

<!-- Modal DESHABILITAR -->
<div id="disableModal" class="modal hidden">
  <div class="modal-content" style="max-width:520px">
    <h3 class="disable-title">Deshabilitar usuario</h3>
    <p>Indique el motivo por el cual será deshabilitado. Este campo es obligatorio.</p>
    <textarea id="disableReason" rows="5" placeholder="Escriba el motivo..." style="width:100%;border:1px solid #d1d5db;border-radius:6px;padding:10px;"></textarea>
    <div class="modal-actions" style="margin-top:12px">
      <button id="disableCancelBtn">Cancelar</button>
      <button id="disableConfirmBtn" class="delete-btn">Deshabilitar</button>
    </div>
  </div>
  <div id="loadingSpinner" class="hidden"><div class="spinner"></div></div>
</div>

<!--  Modal HABILITAR -->
<div id="enableModal" class="modal hidden">
  <div class="modal-content" style="max-width:400px">
    <h3 class="enable-title">Habilitar usuario</h3>
    <p>¿Estás seguro de que quieres habilitar nuevamente este usuario?</p>
    <div class="modal-actions">
      <button id="enableCancelBtn">Cancelar</button>
      <button id="enableConfirmBtn" class="confirm-enable-btn">Habilitar</button>
    </div>
  </div>
  <div id="loadingSpinner" class="hidden">
    <div class="spinner"></div>
  </div>
</div>

<!-- Modal DETALLE deshabilitación -->
<div id="detailModal" class="modal hidden">
  <div class="modal-content" style="max-width:520px">
    <h3>Detalle de deshabilitación</h3>
    <div id="detailBody" style="text-align:left;color:#374151;margin:12px 0"></div>
    <div class="modal-actions">
      <button id="detailCloseBtn">Cerrar</button>
    </div>
  </div>
</div>

<!-- Alertas centradas -->
<div id="successAlert" class="alert success" style="display:none;">
  <div class="alert-icon">✓</div>
  <span id="successMessageAlert">Acción realizada con éxito.</span>
</div>

<div id="errorAlert" class="alert error" style="display:none;">
  <div class="alert-icon">✕</div>
  <span id="errorMessageAlert">Ocurrió un error.</span>
</div>

{% endblock principal %}

{% block js %}
<script>window.currentUserRut = "{{ usuario_id|escapejs }}";</script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="{% static 'staffweb/js/administrar_usuarios.js' %}"></script>
{% endblock js %}