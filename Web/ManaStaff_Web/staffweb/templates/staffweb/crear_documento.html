{% extends 'staffweb/plantilla.html' %}
{% load static %}

{% block head %}
 <!--STATIC CSS -->
<link rel="stylesheet" href="{% static 'staffweb/css/crear_documento.css' %}">
<title>Crear Documento</title>
{% endblock head%}

{% block principal %}
<div class="header">
    <h1>Crear Documento</h1>
    <p>Complete el formulario para crear un nuevo documento</p>
</div>

{% if messages %}
  {% for m in messages %}
    <div class="success-message show {% if m.tags == 'error' %}is-error{% else %}is-success{% endif %}">
        <span>{{ m }}</span>
    </div>
  {% endfor %}
{% endif %}

<div class="form-container">
  <form id="createDocumentForm" class="document-form" method="post" enctype="multipart/form-data">
    {% csrf_token %}

    <!-- nombre -->
    <div class="form-group">
      <label for="documentName" class="form-label">
        Nombre del Documento <span class="required">*</span>
      </label>
      <input type="text" id="documentName" name="documentName" class="form-input" placeholder="Ej: Contrato, Finiquito..." required>
      <span class="error-message" id="documentNameError"></span>
    </div>

    <!-- estado -->
    <div class="form-group">
      <label class="form-label"><span class="required">*</span> Estado</label>
      <div class="status-options">
        <label class="status-option">
          <input type="radio" name="documentStatus" value="activo" id="statusActivo" checked>
          <div class="status-card">
            <div class="status-icon activo"></div>
            <div class="status-info">
              <div class="status-title">Activo</div>
              <div class="status-description">Requiere archivo</div>
            </div>
          </div>
        </label>
        <label class="status-option">
          <input type="radio" name="documentStatus" value="pendiente" id="statusPendiente">
          <div class="status-card">
            <div class="status-icon pendiente"></div>
            <div class="status-info">
              <div class="status-title">Pendiente</div>
              <div class="status-description">Sin archivo (opcional)</div>
            </div>
          </div>
        </label>
      </div>
    </div>

    <!-- archivo -->
    <div class="form-group">
      <label for="documentFile" class="form-label">
        Archivo <span class="required" id="fileRequired">*</span>
        <span class="optional" id="fileOptional" style="display:none;">(Opcional)</span>
      </label>
      <div class="file-upload-wrapper">
        <input type="file" id="documentFile" name="documentFile" class="file-input" accept=".pdf,.doc,.docx,.jpg,.jpeg,.png">
        <label for="documentFile" class="file-label">
          <span id="fileName">Seleccionar archivo</span>
        </label>
      </div>
      <span class="file-info">PDF, DOC, DOCX, JPG, PNG (MÃ¡x. 10MB)</span>
      <span class="error-message" id="documentFileError"></span>
    </div>

    <!-- usuario -->
    <div class="form-group">
      <label for="userSearch" class="form-label">Usuario Asignado <span class="required">*</span></label>
      <div class="search-wrapper">
        <input type="text" id="userSearch" class="form-input search-input" placeholder="Buscar por nombre o RUT..." autocomplete="off">
        <div id="userDropdown" class="user-dropdown"></div>
      </div>
      <input type="hidden" id="selectedUserId" name="selectedUserId">
      <div id="selectedUserDisplay" class="selected-user"></div>
      <span class="error-message" id="userSearchError"></span>
    </div>

    <!-- vencimiento -->
    <div class="form-group">
      <label for="expirationDate" class="form-label">Fecha de Vencimiento <span class="optional">(Opcional)</span></label>
      <input type="date" id="expirationDate" name="expirationDate" class="form-input">
    </div>

    <div class="form-actions">
      <a href="{% url 'administrar_documentos' %}" class="btn-cancel">Cancelar</a>
      <button type="submit" class="btn-submit">Crear Documento</button>
    </div>
  </form>
</div>

<<<<<<< Updated upstream
<script id="usuarios-data" type="application/json">{{ usuarios_json|default:"[]"|safe }}</script>
<script id="estados-data" type="application/json">{{ estados_json|default:"{}"|safe }}</script>

<script>
(function () {
  const hasError = !!document.querySelector('.success-message.is-error');
  const success  = document.querySelector('.success-message.is-success');

  if (success && !hasError) {
    setTimeout(() => {
      success.classList.remove('show');
    }, 1800);

    setTimeout(() => {
      window.location.href = "{% url 'administrar_documentos' %}";
    }, 2000);
  }
})();
</script>

=======
<!-- JSON para el JS -->
<script id="usuarios-data" type="application/json">{{ usuarios_json|default:"[]"|safe }}</script>
<script id="estados-data" type="application/json">{{ estados_json|default:"{}"|safe }}</script>

>>>>>>> Stashed changes
<script src="{% static 'staffweb/js/crear_documento.js' %}"></script>
{% endblock %}
